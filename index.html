<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ReCarbon - Platform Jejak Karbon</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2ecc71">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f4f7f6 0%, #e8f5e9 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
            padding: 20px 0;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .logo {
            width: 80px;
            height: 80px;
            margin: 0 auto 10px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .logo img {
            width: 70px;
            height: 70px;
            border-radius: 50%;
        }
        
        h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        .tagline {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .auth-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn-primary {
            background: #2ecc71;
            color: white;
        }
        
        .btn-secondary {
            background: white;
            color: #2ecc71;
            border: 2px solid #2ecc71;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .user-type-selector {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        
        .user-type-card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            flex: 1;
            min-width: 280px;
            max-width: 400px;
        }
        
        .user-type-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        
        .user-type-card.active {
            background: #2ecc71;
            color: white;
        }
        
        .user-type-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }
        
        .auth-form {
            background: white;
            padding: 40px;
            border-radius: 15px;
            max-width: 500px;
            margin: 40px auto;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            display: none;
        }
        
        .auth-form.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border 0.3s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #2ecc71;
        }
        
        .dashboard {
            display: none;
        }
        
        .dashboard.active {
            display: block;
        }
        
        .nav-menu {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .nav-item {
            padding: 10px 15px;
            background: #f8f9fa;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            font-weight: 500;
        }
        
        .nav-item:hover, .nav-item.active {
            background: #2ecc71;
            color: white;
        }
        
        .dashboard-section {
            display: none;
        }
        
        .dashboard-section.active {
            display: block;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .stat-icon {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #2ecc71;
            margin: 10px 0;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9em;
        }
        
        .action-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .action-card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .action-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        
        .action-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }
        
        .form-container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .validation-requirements {
            background: #fff3cd;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #ffc107;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        
        th {
            background: #2ecc71;
            color: white;
            font-weight: bold;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .reward-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .reward-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .reward-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }
        
        .reward-points {
            color: #2ecc71;
            font-weight: bold;
            font-size: 1.2em;
            margin: 10px 0;
        }
        
        .progress-bar {
            background: #e0e0e0;
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            background: linear-gradient(90deg, #2ecc71, #27ae60);
            height: 100%;
            transition: width 0.3s;
        }
        
        .hidden {
            display: none !important;
        }
        
        .welcome-message {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .marketplace-item {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .marketplace-info h3 {
            color: #2ecc71;
            margin-bottom: 5px;
        }
        
        .marketplace-price {
            font-size: 1.3em;
            font-weight: bold;
            color: #27ae60;
        }
        
        .info-box {
            background: #E3F2FD;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #2196F3;
        }
        
        .mrv-status {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
        }
        
        .mrv-status.pending { background: #FFF3E0; color: #F57C00; }
        .mrv-status.verified { background: #E8F5E9; color: #2ecc71; }
        .mrv-status.converted { background: #E3F2FD; color: #2196F3; }
        
        .profile-photo-container {
            position: relative;
            width: 80px;
            height: 80px;
            margin: 0 auto 10px;
        }
        
        .profile-photo {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid white;
            background: #f4f7f6;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            color: #2ecc71;
        }
        
        .profile-photo-edit {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 30px;
            height: 30px;
            background: #2ecc71;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 2px solid white;
            color: white;
            font-size: 0.9em;
            transition: all 0.3s;
        }
        
        .profile-photo-edit:hover {
            background: #27ae60;
            transform: scale(1.1);
        }
        
        .profile-photo-input {
            display: none;
        }
        
        .header-user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        
        @media (max-width: 768px) {
            .stats-grid, .action-grid, .reward-grid {
                grid-template-columns: 1fr;
            }
            
            table {
                font-size: 0.9em;
            }
            
            th, td {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="logo">
                <img src="logo-recarbon.png" alt="ReCarbon Logo">
            </div>
            <h1>ReCarbon</h1>
            <p class="tagline">Aksi Hijau = Poin Reward = Bumi Lebih Baik!</p>
            
            <div class="auth-buttons" id="authButtons">
                <button class="btn btn-primary" onclick="showAuth('login')">Log In</button>
                <button class="btn btn-secondary" onclick="showAuth('register')">Sign Up</button>
            </div>
            
            <div class="header-user-info hidden" id="headerUserInfo">
                <div class="profile-photo-container">
                    <div class="profile-photo" id="headerProfilePhoto">U</div>
                    <label for="headerProfileInput" class="profile-photo-edit" title="Ubah Foto">üì∑</label>
                    <input type="file" id="headerProfileInput" class="profile-photo-input" accept="image/*" onchange="updatePhoto(event, 'header')">
                </div>
                <div>
                    <span id="userNameDisplay" style="font-weight: bold;"></span><br>
                    <small id="userEmailDisplay" style="opacity: 0.9;"></small>
                </div>
                <button class="btn btn-secondary" onclick="logout()" style="margin-left: 10px; padding: 5px 15px; font-size: 0.9em;">üö™ Log Out</button>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- User Type Selector (3 Tipe) -->
        <div class="user-type-selector" id="userTypeSelector">
            <div class="user-type-card" onclick="selectUserType('individual')" id="card-individual">
                <div class="user-type-icon">üë§</div>
                <h3>Individu/Komunitas</h3>
                <p>Aksi hijau ‚Üí Poin ‚Üí Voucher</p>
            </div>
            <div class="user-type-card" onclick="selectUserType('provider')" id="card-provider">
                <div class="user-type-icon">üìä</div>
                <h3>Penyedia (Admin)</h3>
                <p>MRV ‚Üí Kredit ‚Üí CSR/ESG</p>
            </div>
            <div class="user-type-card" onclick="selectUserType('company')" id="card-company">
                <div class="user-type-icon">üè¢</div>
                <h3>Perusahaan</h3>
                <p>Beli kredit untuk CSR/ESG</p>
            </div>
        </div>

        <!-- Login Form -->
        <div class="auth-form" id="loginForm">
            <h2 style="text-align: center; margin-bottom: 30px; color: #2ecc71;">Log In</h2>
            <form onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="loginEmail" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="loginPassword" required minlength="6">
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Log In</button>
                <p style="text-align: center; margin-top: 20px;">
                    Belum punya akun? <a href="#" onclick="showAuth('register')" style="color: #2ecc71;">Sign Up</a>
                </p>
            </form>
        </div>

        <!-- Register Form -->
        <div class="auth-form" id="registerForm">
            <h2 style="text-align: center; margin-bottom: 30px; color: #2ecc71;">Sign Up</h2>
            <form onsubmit="handleRegister(event)">
                <div class="form-group">
                    <label id="nameLabel">Nama Lengkap / Nama Perusahaan</label>
                    <input type="text" id="registerName" required minlength="3">
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="registerEmail" required>
                </div>
                <div class="form-group" id="companyNameGroup" style="display: none;">
                    <label>Nama Perusahaan</label>
                    <input type="text" id="registerCompanyName">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="registerPassword" required minlength="6">
                    <div class="progress-bar" style="margin-top: 5px;">
                        <div class="progress-fill" id="passwordStrength" style="width: 0%"></div>
                    </div>
                </div>
                <div class="form-group">
                    <label>Konfirmasi Password</label>
                    <input type="password" id="registerConfirmPassword" required>
                </div>
                <div class="form-group">
                    <label style="font-weight: normal;">
                        <input type="checkbox" required style="width: auto; margin-right: 10px;">
                        Saya setuju dengan <a href="#" style="color: #2ecc71;">Syarat & Ketentuan</a>
                    </label>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Sign Up</button>
                <p style="text-align: center; margin-top: 20px;">
                    Sudah punya akun? <a href="#" onclick="showAuth('login')" style="color: #2ecc71;">Log In</a>
                </p>
            </form>
        </div>

        <!-- ===== INDIVIDUAL DASHBOARD ===== -->
        <div class="dashboard" id="individualDashboard">
            <div class="nav-menu">
                <button class="nav-item active" onclick="showSection('individual', 'home')">üè† Beranda</button>
                <button class="nav-item" onclick="showSection('individual', 'history')">üìú Riwayat</button>
                <button class="nav-item" onclick="showSection('individual', 'rewards')">üéÅ Reward</button>
                <button class="nav-item" onclick="showSection('individual', 'settings')">‚öôÔ∏è Pengaturan</button>
            </div>

            <!-- Individual Home -->
            <div class="dashboard-section active" id="individual-home">
                <div class="welcome-message">
                    <h2>Halo, Pejuang Iklim! üëã</h2>
                    <p>Aksi hijau kamu = Poin yang bisa ditukar voucher!</p>
                </div>

                <div class="info-box">
                    <strong>‚ÑπÔ∏è Cara Kerja:</strong><br>
                    1Ô∏è‚É£ Lakukan aksi hijau (transport, tanam, daur ulang, energi)<br>
                    2Ô∏è‚É£ Dapatkan poin reward<br>
                    3Ô∏è‚É£ Tukar poin dengan voucher merchant mitra<br>
                    <small style="color: #666; display: block; margin-top: 10px;">üìä Data aksi kamu akan diverifikasi dan dikonversi menjadi kredit karbon oleh tim ReCarbon untuk program CSR & ESG perusahaan</small>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">‚≠ê</div>
                        <div class="stat-value" id="indTotalPoints">0</div>
                        <div class="stat-label">Total Poin</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üåç</div>
                        <div class="stat-value" id="indCO2Reduction">0 kg</div>
                        <div class="stat-label">Kontribusi CO‚ÇÇ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚úÖ</div>
                        <div class="stat-value" id="indTotalActions">0</div>
                        <div class="stat-label">Aksi Dilakukan</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üéØ</div>
                        <div class="stat-value" id="indNextLevel">0/1000</div>
                        <div class="stat-label">Ke Level Berikutnya</div>
                        <div class="progress-bar" style="margin-top: 10px;">
                            <div class="progress-fill" style="width: 0%" id="levelProgress"></div>
                        </div>
                    </div>
                </div>

                <h2 style="margin: 30px 0 20px; color: #2ecc71;">üöÄ Mulai Aksi Hijau</h2>
                <p style="margin-bottom: 20px;">Pilih aksi dan dapatkan poin!</p>

                <div class="action-grid">
                    <div class="action-card" onclick="showActionForm('transport')">
                        <div class="action-icon">üö¥</div>
                        <h3>Transport</h3>
                        <p>Bersepeda, jalan kaki, transportasi umum</p>
                    </div>
                    <div class="action-card" onclick="showActionForm('plant')">
                        <div class="action-icon">üå±</div>
                        <h3>Tanam</h3>
                        <p>Menanam pohon di lingkungan sekitar</p>
                    </div>
                    <div class="action-card" onclick="showActionForm('recycle')">
                        <div class="action-icon">‚ôªÔ∏è</div>
                        <h3>Daur Ulang</h3>
                        <p>Recycling sampah plastik, kertas, logam</p>
                    </div>
                    <div class="action-card" onclick="showActionForm('energy')">
                        <div class="action-icon">‚ö°</div>
                        <h3>Energi</h3>
                        <p>Hemat energi dan energi terbarukan</p>
                    </div>
                </div>

                <!-- Action Form -->
                <div class="form-container hidden" id="actionForm">
                    <h3 style="margin-bottom: 20px; color: #2ecc71;" id="actionFormTitle">Form Aksi Hijau</h3>
                    
                    <div class="validation-requirements">
                        <h4>üìã Persyaratan Validasi (MRV)</h4>
                        <div class="form-group" style="margin-top: 15px;">
                            <label>üìç Lokasi GPS</label>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <span id="locationStatus">Menunggu izin lokasi...</span>
                                <button type="button" class="btn btn-secondary" onclick="getLocation()" style="padding: 5px 15px; font-size: 0.9em;">üîÑ Refresh</button>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>üì∏ Upload Bukti Foto</label>
                            <input type="file" id="actionPhoto" accept="image/*" required>
                            <small style="color: #666;">Foto akan diverifikasi oleh tim ReCarbon</small>
                        </div>
                        
                        <div class="form-group">
                            <label>üìÖ Tanggal Aksi</label>
                            <input type="date" id="actionDate" required>
                        </div>
                        
                        <div class="form-group" id="quantityGroup">
                            <label>üìè Jumlah</label>
                            <input type="number" id="actionQuantity" step="0.1" required>
                            <small id="quantityLabel" style="color: #666;">(km)</small>
                        </div>

                        <div class="form-group hidden" id="transportRouteGroup">
                            <label>üõ£Ô∏è Jenis Transport</label>
                            <select id="transportRoute">
                                <option value="">Pilih Jenis</option>
                                <option value="sepeda">Sepeda</option>
                                <option value="jalan">Jalan Kaki</option>
                                <option value="umum">Transportasi Umum</option>
                            </select>
                        </div>

                        <div class="form-group hidden" id="treeTypeGroup">
                            <label>üå≥ Jenis Pohon</label>
                            <select id="treeType">
                                <option value="">Pilih Jenis</option>
                                <option value="buah">Pohon Buah</option>
                                <option value="hutan">Pohon Hutan</option>
                                <option value="bakau">Pohon Bakau</option>
                            </select>
                        </div>

                        <div class="form-group hidden" id="materialTypeGroup">
                            <label>‚ôªÔ∏è Jenis Material</label>
                            <select id="materialType">
                                <option value="">Pilih Material</option>
                                <option value="plastik">Plastik</option>
                                <option value="kertas">Kertas</option>
                                <option value="logam">Logam</option>
                            </select>
                        </div>
                    </div>

                    <div style="background: #e8f5e9; padding: 15px; border-radius: 8px; margin: 20px 0;">
                        <h4>üéÅ Estimasi Reward</h4>
                        <p>Data akan diverifikasi sebelum poin diberikan</p>
                        <div style="margin-top: 10px;">
                            <strong>Estimasi Poin:</strong> <span id="estimatedPoints" style="color: #2ecc71; font-size: 1.2em;">+0 Poin</span>
                        </div>
                    </div>

                    <button class="btn btn-primary" onclick="submitAction()" style="width: 100%;">Kirim Aksi</button>
                    <button class="btn btn-secondary" onclick="hideActionForm()" style="width: 100%; margin-top: 10px;">Batal</button>
                </div>
            </div>

            <!-- Individual History -->
            <div class="dashboard-section" id="individual-history">
                <h2 style="margin-bottom: 20px; color: #2ecc71;">üìú Riwayat Aksi</h2>
                <div class="info-box">
                    <strong>‚ÑπÔ∏è Status Validasi:</strong><br>
                    üü° Menunggu = Sedang diverifikasi tim ReCarbon<br>
                    üü¢ Disetujui = Poin sudah ditambahkan<br>
                    üî¥ Ditolak = Data tidak memenuhi syarat MRV
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Tanggal</th>
                            <th>Jenis</th>
                            <th>Jumlah</th>
                            <th>Poin</th>
                            <th>Status MRV</th>
                        </tr>
                    </thead>
                    <tbody id="actionHistoryTable">
                        <tr>
                            <td colspan="5" style="text-align: center; color: #666;">Belum ada riwayat</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Individual Rewards -->
            <div class="dashboard-section" id="individual-rewards">
                <h2 style="margin-bottom: 20px; color: #2ecc71;">üéÅ Reward Store</h2>
                <div class="stat-card" style="margin-bottom: 30px;">
                    <div class="stat-value" id="availablePoints" style="color: #2ecc71;">0 Poin</div>
                    <div class="stat-label">Poin Tersedia</div>
                </div>
                <div class="info-box">
                    <strong>ü§ù Merchant Mitra:</strong><br>
                    Voucher dapat ditukar di merchant yang sudah bekerjasama dengan ReCarbon
                </div>
                <div class="reward-grid">
                    <div class="reward-card">
                        <div class="reward-icon">üõçÔ∏è</div>
                        <h4>Voucher Belanja</h4>
                        <p>Diskon 50% di toko mitra</p>
                        <div class="reward-points">5000 Poin</div>
                        <button class="btn btn-primary" onclick="redeemReward(5000)">Tukar</button>
                    </div>
                    <div class="reward-card">
                        <div class="reward-icon">‚òï</div>
                        <h4>Voucher Kopi</h4>
                        <p>Gratis 1 gelas kopi lokal</p>
                        <div class="reward-points">3000 Poin</div>
                        <button class="btn btn-primary" onclick="redeemReward(3000)">Tukar</button>
                    </div>
                    <div class="reward-card">
                        <div class="reward-icon">üçî</div>
                        <h4>Voucher Makanan</h4>
                        <p>Diskon 30% di restoran mitra</p>
                        <div class="reward-points">7000 Poin</div>
                        <button class="btn btn-primary" onclick="redeemReward(7000)">Tukar</button>
                    </div>
                    <div class="reward-card">
                        <div class="reward-icon">üé¨</div>
                        <h4>Tiket Bioskop</h4>
                        <p>Nonton gratis 1 tiket</p>
                        <div class="reward-points">15000 Poin</div>
                        <button class="btn btn-primary" onclick="redeemReward(15000)">Tukar</button>
                    </div>
                </div>
            </div>

            <!-- Individual Settings -->
            <div class="dashboard-section" id="individual-settings">
                <h2 style="margin-bottom: 20px; color: #2ecc71;">‚öôÔ∏è Pengaturan</h2>
                <div class="form-container">
                    <h3 style="margin-bottom: 20px; color: #2ecc71;">üë§ Profil Akun</h3>
                    <div class="form-group" style="text-align: center;">
                        <div class="profile-photo-container" style="margin: 0 auto 15px;">
                            <img id="settingsProfilePhoto" class="profile-photo" src="" alt="Foto Profil" style="display: none;">
                            <div class="profile-photo" id="settingsProfilePhotoPlaceholder">U</div>
                            <label for="settingsProfileInput" class="profile-photo-edit" title="Ubah Foto">üì∑</label>
                            <input type="file" id="settingsProfileInput" class="profile-photo-input" accept="image/*" onchange="updatePhoto(event, 'settings')">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Nama</label>
                        <span id="settingsName" style="padding: 10px; background: #f8f9fa; border-radius: 8px; display: block;">-</span>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <span id="settingsEmail" style="padding: 10px; background: #f8f9fa; border-radius: 8px; display: block;">-</span>
                    </div>
                    <button class="btn btn-secondary" onclick="logout()" style="width: 100%; margin-top: 20px;">üö™ Log Out</button>
                </div>
            </div>
        </div>

        <!-- ===== PROVIDER DASHBOARD (ADMIN) ===== -->
        <div class="dashboard" id="providerDashboard">
            <div class="nav-menu">
                <button class="nav-item active" onclick="showSection('provider', 'dashboard')">üìä Dashboard</button>
                <button class="nav-item" onclick="showSection('provider', 'mrv')">üîç Verifikasi MRV</button>
                <button class="nav-item" onclick="showSection('provider', 'credits')">üå± Kredit Karbon</button>
                <button class="nav-item" onclick="showSection('provider', 'reports')">üìà Laporan ESG</button>
                <button class="nav-item" onclick="showSection('provider', 'settings')">‚öôÔ∏è Pengaturan</button>
            </div>

            <!-- Provider Dashboard -->
            <div class="dashboard-section active" id="provider-dashboard">
                <h2 style="margin-bottom: 20px; color: #2ecc71;">üìä Dashboard Admin</h2>
                <p style="margin-bottom: 30px;">Kelola MRV dan kredit karbon untuk CSR/ESG</p>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">üìù</div>
                        <div class="stat-value" id="provPendingMRV">0</div>
                        <div class="stat-label">Menunggu Verifikasi</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚úÖ</div>
                        <div class="stat-value" id="provVerified">0</div>
                        <div class="stat-label">Diverifikasi</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üå±</div>
                        <div class="stat-value" id="provCredits">0 kg</div>
                        <div class="stat-label">Kredit Tersedia</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üí∞</div>
                        <div class="stat-value" id="provRevenue">Rp 0</div>
                        <div class="stat-label">Pendapatan</div>
                    </div>
                </div>

                <div class="info-box">
                    <strong>üîÑ Alur Kerja MRV:</strong><br>
                    1Ô∏è‚É£ Individu submit aksi hijau<br>
                    2Ô∏è‚É£ Admin verifikasi (Measurement, Reporting, Verification)<br>
                    3Ô∏è‚É£ Konversi menjadi kredit karbon<br>
                    4Ô∏è‚É£ Tawarkan ke perusahaan untuk CSR/ESG
                </div>
            </div>

            <!-- Provider MRV Verification -->
            <div class="dashboard-section" id="provider-mrv">
                <h2 style="margin-bottom: 20px; color: #2ecc71;">üîç Verifikasi MRV</h2>
                <p style="margin-bottom: 20px;">Verifikasi aksi hijau dari individu</p>
                
                <table>
                    <thead>
                        <tr>
                            <th>Tanggal</th>
                            <th>User</th>
                            <th>Jenis</th>
                            <th>Jumlah</th>
                            <th>Bukti</th>
                            <th>Status</th>
                            <th>Aksi</th>
                        </tr>
                    </thead>
                    <tbody id="mrvTable">
                        <tr>
                            <td colspan="7" style="text-align: center; color: #666;">Belum ada data untuk diverifikasi</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Provider Credits -->
            <div class="dashboard-section" id="provider-credits">
                <h2 style="margin-bottom: 20px; color: #2ecc71;">üå± Manajemen Kredit Karbon</h2>
                
                <div class="stat-card" style="margin-bottom: 30px;">
                    <div class="stat-icon">üåç</div>
                    <div class="stat-value" id="providerTotalCredits">0 kg CO‚ÇÇ</div>
                    <div class="stat-label">Total Kredit Tersedia untuk Dijual</div>
                </div>

                <h3 style="margin: 30px 0 20px;">Daftar Kredit</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Tanggal</th>
                            <th>Sumber</th>
                            <th>Jenis</th>
                            <th>Jumlah</th>
                            <th>Harga/kg</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="providerCreditsTable">
                        <tr>
                            <td colspan="6" style="text-align: center; color: #666;">Belum ada kredit</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Provider ESG Reports -->
            <div class="dashboard-section" id="provider-reports">
                <h2 style="margin-bottom: 20px; color: #2ecc71;">üìà Laporan ESG & CSR</h2>
                
                <div class="form-container">
                    <h3 style="margin-bottom: 20px;">Generate Laporan</h3>
                    <div class="form-group">
                        <label>Periode</label>
                        <select>
                            <option>Bulan Ini</option>
                            <option>Kuartal Ini</option>
                            <option>Tahun Ini</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Tipe Laporan</label>
                        <select>
                            <option>Laporan Dampak Lingkungan</option>
                            <option>Laporan CSR</option>
                            <option>Laporan ESG</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" style="width: 100%;">üì• Download Laporan</button>
                </div>
            </div>

            <!-- Provider Settings -->
            <div class="dashboard-section" id="provider-settings">
                <h2 style="margin-bottom: 20px; color: #2ecc71;">‚öôÔ∏è Pengaturan</h2>
                <div class="form-container">
                    <div class="form-group">
                        <label>Nama Admin</label>
                        <span id="providerName" style="padding: 10px; background: #f8f9fa; border-radius: 8px; display: block;">-</span>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <span id="providerEmail" style="padding: 10px; background: #f8f9fa; border-radius: 8px; display: block;">-</span>
                    </div>
                    <button class="btn btn-secondary" onclick="logout()" style="width: 100%; margin-top: 20px;">üö™ Log Out</button>
                </div>
            </div>
        </div>

        <!-- ===== COMPANY DASHBOARD ===== -->
        <div class="dashboard" id="companyDashboard">
            <div class="nav-menu">
                <button class="nav-item active" onclick="showSection('company', 'dashboard')">üìä Dashboard</button>
                <button class="nav-item" onclick="showSection('company', 'marketplace')">üõí Marketplace</button>
                <button class="nav-item" onclick="showSection('company', 'portfolio')">üíº Portofolio</button>
                <button class="nav-item" onclick="showSection('company', 'esg')">üìä Laporan ESG</button>
                <button class="nav-item" onclick="showSection('company', 'profile')">üè¢ Profil</button>
            </div>

            <!-- Company Dashboard -->
            <div class="dashboard-section active" id="company-dashboard">
                <h2 style="margin-bottom: 20px; color: #2ecc71;">üìä Dashboard Perusahaan</h2>
                <p style="margin-bottom: 30px;">Kelola kredit karbon untuk CSR & ESG</p>

                <div class="info-box">
                    <strong>ü§ù Kerjasama CSR & ESG:</strong><br>
                    Kredit karbon dari ReCarbon dapat digunakan untuk:<br>
                    ‚úÖ Laporan Keberlanjutan (Sustainability Report)<br>
                    ‚úÖ Program Corporate Social Responsibility<br>
                    ‚úÖ ESG (Environmental, Social, Governance) Reporting<br>
                    ‚úÖ Carbon Offset untuk operasional perusahaan
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">üåç</div>
                        <div class="stat-value" id="compTotalCredits">0 kg</div>
                        <div class="stat-label">Total Kredit Dibeli</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üí∞</div>
                        <div class="stat-value" id="compTotalInvestment">Rp 0</div>
                        <div class="stat-label">Total Investasi CSR</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üìä</div>
                        <div class="stat-value" id="compTotalTransactions">0</div>
                        <div class="stat-label">Total Transaksi</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üìà</div>
                        <div class="stat-value" id="compCO2Offset">0 kg</div>
                        <div class="stat-label">CO‚ÇÇ Di-offset</div>
                    </div>
                </div>
            </div>

            <!-- Company Marketplace -->
            <div class="dashboard-section" id="company-marketplace">
                <h2 style="margin-bottom: 20px; color: #2ecc71;">üõí Marketplace Kredit Karbon</h2>
                <p style="margin-bottom: 30px;">Beli kredit karbon dari ReCarbon untuk program CSR/ESG</p>

                <div class="info-box">
                    <strong>‚ÑπÔ∏è Catatan:</strong> Kredit karbon dijual oleh ReCarbon (bukan langsung dari individu). 
                    Semua kredit sudah melalui proses MRV dan tersertifikasi.
                </div>

                <div id="marketplaceList">
                    <div class="marketplace-item">
                        <div class="marketplace-info">
                            <h3>Paket Reforestasi</h3>
                            <p>Jenis: Penanaman Pohon</p>
                            <p>Jumlah: 100 kg CO‚ÇÇ</p>
                            <p>Sertifikasi: Verified Carbon Standard</p>
                        </div>
                        <div class="marketplace-price">
                            Rp 50.000<br>
                            <button class="btn btn-primary" onclick="buyCarbonCredit('reforestasi', 100, 50000)">Beli</button>
                        </div>
                    </div>
                    <div class="marketplace-item">
                        <div class="marketplace-info">
                            <h3>Paket Energi Terbarukan</h3>
                            <p>Jenis: Solar Panel</p>
                            <p>Jumlah: 500 kg CO‚ÇÇ</p>
                            <p>Sertifikasi: Gold Standard</p>
                        </div>
                        <div class="marketplace-price">
                            Rp 200.000<br>
                            <button class="btn btn-primary" onclick="buyCarbonCredit('energy', 500, 200000)">Beli</button>
                        </div>
                    </div>
                    <div class="marketplace-item">
                        <div class="marketplace-info">
                            <h3>Paket Daur Ulang</h3>
                            <p>Jenis: Waste Management</p>
                            <p>Jumlah: 250 kg CO‚ÇÇ</p>
                            <p>Sertifikasi: VCS Verified</p>
                        </div>
                        <div class="marketplace-price">
                            Rp 100.000<br>
                            <button class="btn btn-primary" onclick="buyCarbonCredit('recycle', 250, 100000)">Beli</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Company Portfolio -->
            <div class="dashboard-section" id="company-portfolio">
                <h2 style="margin-bottom: 20px; color: #2ecc71;">üíº Portofolio Kredit Karbon</h2>
                
                <table>
                    <thead>
                        <tr>
                            <th>Tanggal Beli</th>
                            <th>Jenis</th>
                            <th>Jumlah</th>
                            <th>Harga</th>
                            <th>Sertifikat</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="companyPortfolioTable">
                        <tr>
                            <td colspan="6" style="text-align: center; color: #666;">Belum ada kredit dalam portofolio</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Company ESG Reports -->
            <div class="dashboard-section" id="company-esg">
                <h2 style="margin-bottom: 20px; color: #2ecc71;">üìä Laporan ESG</h2>
                
                <div class="form-container">
                    <h3 style="margin-bottom: 20px;">Download Laporan untuk CSR/ESG</h3>
                    <div class="form-group">
                        <label>Periode</label>
                        <select>
                            <option>2024 - Q1</option>
                            <option>2024 - Q2</option>
                            <option>2024 - Q3</option>
                            <option>2024 - Q4</option>
                            <option>2024 - Full Year</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Format</label>
                        <select>
                            <option>PDF</option>
                            <option>Excel</option>
                            <option>JSON</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" style="width: 100%;">üì• Download Laporan ESG</button>
                </div>

                <div class="info-box" style="margin-top: 20px;">
                    <strong>üìã Laporan mencakup:</strong><br>
                    ‚úÖ Total karbon yang di-offset<br>
                    ‚úÖ Detail proyek yang didukung<br>
                    ‚úÖ Sertifikasi dan verifikasi<br>
                    ‚úÖ Dampak sosial & lingkungan<br>
                    ‚úÖ Cocok untuk Sustainability Report
                </div>
            </div>

            <!-- Company Profile -->
            <div class="dashboard-section" id="company-profile">
                <h2 style="margin-bottom: 20px; color: #2ecc71;">üè¢ Profil Perusahaan</h2>
                
                <div class="form-container">
                    <h3 style="margin-bottom: 20px; color: #2ecc71;">üì∑ Logo Perusahaan</h3>
                    <div class="form-group" style="text-align: center;">
                        <div class="profile-photo-container" style="margin: 0 auto 15px;">
                            <img id="companyProfilePhoto" class="profile-photo" src="" alt="Logo" style="display: none;">
                            <div class="profile-photo" id="companyProfilePhotoPlaceholder">üè¢</div>
                            <label for="companyProfileInput" class="profile-photo-edit" title="Ubah Logo">üì∑</label>
                            <input type="file" id="companyProfileInput" class="profile-photo-input" accept="image/*" onchange="updatePhoto(event, 'company')">
                        </div>
                    </div>
                    
                    <h3 style="margin-bottom: 20px; color: #2ecc71; margin-top: 30px;">Informasi Perusahaan</h3>
                    <div class="form-group">
                        <label>Nama Perusahaan</label>
                        <span id="companyProfileName" style="padding: 10px; background: #f8f9fa; border-radius: 8px; display: block;">-</span>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <span id="companyProfileEmail" style="padding: 10px; background: #f8f9fa; border-radius: 8px; display: block;">-</span>
                    </div>
                    <div class="form-group">
                        <label>Status Verifikasi</label>
                        <div style="padding: 10px; background: #fff3cd; border-radius: 8px; border-left: 4px solid #ffc107;">
                            <strong>‚è≥ Menunggu Verifikasi</strong><br>
                            <small style="color: #666;">Untuk akses penuh fitur CSR/ESG</small>
                        </div>
                    </div>
                    <button class="btn btn-secondary" onclick="logout()" style="width: 100%; margin-top: 20px;">üö™ Log Out</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" style="display: none; position: fixed; top: 20px; right: 20px; background: #2ecc71; color: white; padding: 15px 25px; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); z-index: 10000;">
        ‚úÖ Berhasil!
    </div>

    <script>
        // Global Variables
        let currentUserType = null;
        let currentUser = null;
        let userPoints = 0;
        let co2Reduction = 0;
        let actions = [];
        let individualPhoto = null;
        let companyPhoto = null;
        
        // Provider Variables
        let pendingMRV = 0;
        let verifiedActions = 0;
        let providerCredits = 0;
        let providerRevenue = 0;
        
        // Company Variables
        let companyCredits = 0;
        let companyInvestment = 0;
        let companyTransactions = 0;

        function showAuth(type) {
            document.getElementById('loginForm').classList.remove('active');
            document.getElementById('registerForm').classList.remove('active');
            document.getElementById(type + 'Form').classList.add('active');
        }

        function selectUserType(type) {
            currentUserType = type;
            document.querySelectorAll('.user-type-card').forEach(card => card.classList.remove('active'));
            document.getElementById('card-' + type).classList.add('active');
            
            if (type === 'company') {
                document.getElementById('companyNameGroup').style.display = 'block';
                document.getElementById('nameLabel').textContent = 'Nama Perusahaan';
            } else {
                document.getElementById('companyNameGroup').style.display = 'none';
                document.getElementById('nameLabel').textContent = 'Nama Lengkap';
            }
        }

        function handleLogin(e) {
            e.preventDefault();
            currentUser = {
                email: document.getElementById('loginEmail').value,
                name: 'User',
                type: currentUserType || 'individual'
            };
            showDashboard();
        }

        function handleRegister(e) {
            e.preventDefault();
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            
            if (password !== confirmPassword) {
                showToast('Password tidak cocok!', 'error');
                return;
            }
            
            currentUser = {
                email: document.getElementById('registerEmail').value,
                name: document.getElementById('registerName').value,
                type: currentUserType || 'individual'
            };
            showToast('Akun berhasil dibuat!');
            showDashboard();
        }

        function showDashboard() {
            document.getElementById('userTypeSelector').style.display = 'none';
            document.getElementById('loginForm').classList.remove('active');
            document.getElementById('registerForm').classList.remove('active');
            document.getElementById('authButtons').classList.add('hidden');
            document.getElementById('headerUserInfo').classList.remove('hidden');
            document.getElementById('userNameDisplay').textContent = currentUser.name;
            document.getElementById('userEmailDisplay').textContent = currentUser.email;
            document.getElementById('settingsName').textContent = currentUser.name;
            document.getElementById('settingsEmail').textContent = currentUser.email;
            
            loadSavedPhotos();
            
            if (currentUser.type === 'company') {
                document.getElementById('individualDashboard').classList.remove('active');
                document.getElementById('providerDashboard').classList.remove('active');
                document.getElementById('companyDashboard').classList.add('active');
                document.getElementById('companyProfileName').textContent = currentUser.name;
                document.getElementById('companyProfileEmail').textContent = currentUser.email;
                updateCompanyStats();
            } else if (currentUser.type === 'provider') {
                document.getElementById('individualDashboard').classList.remove('active');
                document.getElementById('companyDashboard').classList.remove('active');
                document.getElementById('providerDashboard').classList.add('active');
                document.getElementById('providerName').textContent = currentUser.name;
                document.getElementById('providerEmail').textContent = currentUser.email;
                updateProviderStats();
            } else {
                document.getElementById('companyDashboard').classList.remove('active');
                document.getElementById('providerDashboard').classList.remove('active');
                document.getElementById('individualDashboard').classList.add('active');
                updateIndividualStats();
            }
        }

        function showSection(userType, section) {
            const navMenu = document.querySelector('#' + userType + 'Dashboard .nav-menu');
            navMenu.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            event.target.classList.add('active');
            
            const sections = document.querySelectorAll('#' + userType + 'Dashboard .dashboard-section');
            sections.forEach(s => s.classList.remove('active'));
            document.getElementById(userType + '-' + section).classList.add('active');
        }

        function showActionForm(type) {
            const form = document.getElementById('actionForm');
            form.classList.remove('hidden');
            document.getElementById('transportRouteGroup').classList.add('hidden');
            document.getElementById('treeTypeGroup').classList.add('hidden');
            document.getElementById('materialTypeGroup').classList.add('hidden');
            
            if (type === 'transport') {
                document.getElementById('actionFormTitle').textContent = 'üö¥ Transport Hijau';
                document.getElementById('transportRouteGroup').classList.remove('hidden');
                document.getElementById('quantityLabel').textContent = '(km)';
            } else if (type === 'plant') {
                document.getElementById('actionFormTitle').textContent = 'üå± Tanam Pohon';
                document.getElementById('treeTypeGroup').classList.remove('hidden');
                document.getElementById('quantityLabel').textContent = '(pohon)';
            } else if (type === 'recycle') {
                document.getElementById('actionFormTitle').textContent = '‚ôªÔ∏è Daur Ulang';
                document.getElementById('materialTypeGroup').classList.remove('hidden');
                document.getElementById('quantityLabel').textContent = '(kg)';
            } else {
                document.getElementById('actionFormTitle').textContent = '‚ö° Hemat Energi';
                document.getElementById('quantityLabel').textContent = '(kWh)';
            }
        }

        function hideActionForm() {
            document.getElementById('actionForm').classList.add('hidden');
        }

        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (p) => {
                        document.getElementById('locationStatus').textContent = '‚úÖ ' + p.coords.latitude.toFixed(2) + ', ' + p.coords.longitude.toFixed(2);
                    },
                    () => {
                        document.getElementById('locationStatus').textContent = '‚ùå Gagal';
                    }
                );
            }
        }

        function submitAction() {
            const quantity = parseFloat(document.getElementById('actionQuantity').value);
            if (!quantity) {
                showToast('Isi jumlah!', 'error');
                return;
            }
            
            const points = Math.floor(quantity * 10);
            const co2 = quantity * 2.5;
            
            userPoints += points;
            co2Reduction += co2;
            pendingMRV++;
            
            actions.unshift({
                date: new Date().toISOString().split('T')[0],
                type: document.getElementById('actionFormTitle').textContent,
                quantity: quantity,
                points: points,
                co2: co2,
                status: 'pending'
            });
            
            updateIndividualStats();
            updateProviderStats();
            hideActionForm();
            showToast('Aksi dikirim! Menunggu verifikasi MRV', 'success');
        }

        function updateIndividualStats() {
            document.getElementById('indTotalPoints').textContent = userPoints;
            document.getElementById('indCO2Reduction').textContent = co2Reduction.toFixed(1) + ' kg';
            document.getElementById('indTotalActions').textContent = actions.length;
            document.getElementById('availablePoints').textContent = userPoints + ' Poin';
            document.getElementById('indNextLevel').textContent = userPoints + '/1000';
            document.getElementById('levelProgress').style.width = (userPoints % 1000) / 10 + '%';
            
            // Update history table
            const tbody = document.getElementById('actionHistoryTable');
            if (actions.length > 0) {
                tbody.innerHTML = actions.map(a => `
                    <tr>
                        <td>${a.date}</td>
                        <td>${a.type}</td>
                        <td>${a.quantity}</td>
                        <td>+${a.points}</td>
                        <td><span class="mrv-status ${a.status}">${a.status === 'pending' ? 'üü° Menunggu' : a.status === 'approved' ? 'üü¢ Disetujui' : 'üî¥ Ditolak'}</span></td>
                    </tr>
                `).join('');
            }
        }

        function updateProviderStats() {
            document.getElementById('provPendingMRV').textContent = pendingMRV;
            document.getElementById('provVerified').textContent = verifiedActions;
            document.getElementById('provCredits').textContent = providerCredits + ' kg';
            document.getElementById('provRevenue').textContent = 'Rp ' + providerRevenue.toLocaleString();
            document.getElementById('providerTotalCredits').textContent = providerCredits + ' kg CO‚ÇÇ';
        }

        function updateCompanyStats() {
            document.getElementById('compTotalCredits').textContent = companyCredits + ' kg';
            document.getElementById('compTotalInvestment').textContent = 'Rp ' + companyInvestment.toLocaleString();
            document.getElementById('compTotalTransactions').textContent = companyTransactions;
            document.getElementById('compCO2Offset').textContent = companyCredits + ' kg';
        }

        function redeemReward(cost) {
            if (userPoints >= cost) {
                userPoints -= cost;
                updateIndividualStats();
                showToast('Reward berhasil ditukar!', 'success');
            } else {
                showToast('Poin tidak cukup!', 'error');
            }
        }

        function buyCarbonCredit(type, amount, price) {
            companyCredits += amount;
            companyInvestment += price;
            companyTransactions++;
            providerCredits -= amount;
            providerRevenue += price;
            updateCompanyStats();
            updateProviderStats();
            showToast('Kredit karbon berhasil dibeli!', 'success');
        }

        function updatePhoto(event, location) {
            const file = event.target.files[0];
            if (!file) return;
            
            const validTypes = ['image/jpeg', 'image/png', 'image/jpg', 'image/webp'];
            if (!validTypes.includes(file.type)) {
                showToast('Format tidak valid!', 'error');
                return;
            }
            
            if (file.size > 2 * 1024 * 1024) {
                showToast('Max 2MB!', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const photoData = e.target.result;
                
                if (location === 'header' || location === 'settings') {
                    individualPhoto = photoData;
                    localStorage.setItem('individualPhoto', photoData);
                    displayPhoto('headerProfilePhoto', 'headerProfilePhotoPlaceholder', photoData);
                    displayPhoto('settingsProfilePhoto', 'settingsProfilePhotoPlaceholder', photoData);
                } else if (location === 'company') {
                    companyPhoto = photoData;
                    localStorage.setItem('companyPhoto', photoData);
                    displayPhoto('headerProfilePhoto', 'headerProfilePhotoPlaceholder', photoData);
                    displayPhoto('companyProfilePhoto', 'companyProfilePhotoPlaceholder', photoData);
                }
                
                showToast('Foto diupdate!', 'success');
            };
            reader.readAsDataURL(file);
        }

        function displayPhoto(imgId, placeholderId, photoData) {
            const img = document.getElementById(imgId);
            const placeholder = document.getElementById(placeholderId);
            if (img && placeholder) {
                img.src = photoData;
                img.style.display = 'block';
                placeholder.style.display = 'none';
            }
        }

        function loadSavedPhotos() {
            const indPhoto = localStorage.getItem('individualPhoto');
            if (indPhoto) {
                displayPhoto('headerProfilePhoto', 'headerProfilePhotoPlaceholder', indPhoto);
                displayPhoto('settingsProfilePhoto', 'settingsProfilePhotoPlaceholder', indPhoto);
            }
            
            const compPhoto = localStorage.getItem('companyPhoto');
            if (compPhoto) {
                displayPhoto('headerProfilePhoto', 'headerProfilePhotoPlaceholder', compPhoto);
                displayPhoto('companyProfilePhoto', 'companyProfilePhotoPlaceholder', compPhoto);
            }
        }

        function logout() {
            location.reload();
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = (type === 'error' ? '‚ùå ' : '‚úÖ ') + message;
            toast.style.background = type === 'error' ? '#e74c3c' : '#2ecc71';
            toast.style.display = 'block';
            setTimeout(() => toast.style.display = 'none', 3000);
        }

        // Password Strength
        document.getElementById('registerPassword')?.addEventListener('input', function(e) {
            const pwd = e.target.value;
            const bar = document.getElementById('passwordStrength');
            let strength = 0;
            if (pwd.length >= 6) strength += 25;
            if (pwd.length >= 10) strength += 25;
            if (/[A-Z]/.test(pwd)) strength += 25;
            if (/[0-9]/.test(pwd)) strength += 25;
            bar.style.width = strength + '%';
            bar.style.background = strength < 50 ? '#e74c3c' : strength < 75 ? '#f39c12' : '#2ecc71';
        });

        window.onload = function() {
            document.getElementById('actionDate').valueAsDate = new Date();
            loadSavedPhotos();
        };
    </script>
</body>
</html>
